(this["webpackJsonpVirtual-Companion"]=this["webpackJsonpVirtual-Companion"]||[]).push([[0],{43:function(e,t,i){e.exports=i.p+"static/media/Bird_simple.d1d4aa0b.glb"},44:function(e,t,i){e.exports=i.p+"static/media/world.9a0ad0bd.glb"},74:function(e,t,i){e.exports=i(92)},79:function(e,t,i){},80:function(e,t,i){},92:function(e,t,i){"use strict";i.r(t);var n=i(5),a=i.n(n),r=i(39),s=i.n(r),o=(i(79),i(80),i(1)),h=i(2),c=i(3),u=i(4),l=i(19),d=i(0),p=i(40),f=i.n(p),m=i(41),v=i.n(m),g=i(42),y=i(21),w=function(e,t,i,n,a){var r=Math.sqrt(e*e+t*t+i*i);e/=r,t/=r,i/=r;var s=Math.cos(n/2),o=Math.sin(n/2);a.set(e*o,t*o,i*o,s)},k=1.2,b=.5,S=.2,P=function(){function e(){Object(o.a)(this,e),this.position=new d.Vector3(20*Math.random(),2,0),this.velocity=new d.Vector3(.1,.1,.1),this.acceleration=new d.Vector3(0,0,0),this.rotationA=new d.Quaternion,this.rotationB=new d.Quaternion,this.fSteer=new d.Vector3(0,0,0),this.vDesired=new d.Vector3(0,0,0),this.sumVec=new d.Vector3(0,0,0),this.diffVec=new d.Vector3(0,0,0),this.maxForce=.01,this.maxSpeed=this.getRandomArbitrary(.015,.025),this.maxSlowDownSpeed=0,this.slowDownTolerance=.2*.2,this.arriveTolerance=1e-4,this.smoothFactor=.01,this.target=new d.Vector3(0,0,0)}return Object(h.a)(e,[{key:"updateAgent",value:function(e){this.seekTarget(),this.flock(e),this.updatePosition()}},{key:"seekTarget",value:function(){this.seek(),this.applyForce()}},{key:"flock",value:function(e){e.length>0&&(this.seperation(e),this.applyForce(),this.cohesion(e),this.applyForce(),this.align(e),this.applyForce())}},{key:"updatePosition",value:function(){this.sumVec.addVectors(this.velocity,this.acceleration),this.velocity=this.velocity.lerp(this.sumVec,this.smoothFactor),this.velocity.clampLength(-9999,this.maxSpeed),this.position.add(this.velocity),this.acceleration.multiplyScalar(0)}},{key:"applyForce",value:function(){this.acceleration.add(this.fSteer)}},{key:"seek",value:function(){this.vDesired.subVectors(this.target,this.position),this.vDesired.normalize();var e,t,i,n,a,r=this.vDesired.lengthSq();if(r<this.slowDownTolerance&&r>this.arriveTolerance){var s=(e=r,t=this.slowDownTolerance,i=this.arriveTolerance,n=this.maxSpeed,a=this.maxSlowDownSpeed,n+(a-n)*(e-t)/(i-t));this.vDesired.multiplyScalar(s)}else this.vDesired.multiplyScalar(this.maxSpeed);this.fSteer.subVectors(this.vDesired,this.velocity),this.fSteer.clampLength(-99999,this.maxForce)}},{key:"seperation",value:function(e){var t=this;this.fSteer.set(0,0,0),this.sumVec.set(0,0,0),e.length>0&&(e.forEach((function(e){t.diffVec.subVectors(t.position,e.position),t.diffVec.normalize(),t.diffVec.divideScalar(t.diffVec.length()),t.sumVec.add(t.diffVec)})),this.sumVec.divideScalar(e.length),this.sumVec.lengthSq()>0&&(this.sumVec.normalize(),this.sumVec.clampLength(-99999,this.maxSpeed),this.fSteer.subVectors(this.sumVec,this.velocity),this.fSteer.clampLength(-99999,this.maxForce),this.fSteer.multiplyScalar(k)))}},{key:"cohesion",value:function(e){var t=this;this.target.set(0,0,0),this.fSteer.set(0,0,0),e.length>0&&(e.forEach((function(e){t.target.add(e.position)})),this.target.divideScalar(e.length),this.seek(),this.fSteer.multiplyScalar(b))}},{key:"align",value:function(e){var t=this;this.fSteer.set(0,0,0),e.length>0&&(e.forEach((function(e){t.fSteer.add(e.velocity)})),this.fSteer.divideScalar(e.length),this.fSteer.normalize(),this.fSteer.multiplyScalar(this.maxSpeed),this.fSteer.sub(this.velocity),this.fSteer.clampLength(-99999,this.maxForce),this.fSteer.multiplyScalar(S))}},{key:"setTarget",value:function(e){this.target.copy(e)}},{key:"getRandomArbitrary",value:function(e,t){return Math.random()*(t-e)+e}}]),e}(),O=i(43),V=i.n(O),x=new y.a,M=function(e){Object(c.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(o.a)(this,i),(n=t.call(this)).loadPigeon(e),n}return Object(h.a)(i,[{key:"loadPigeon",value:function(e){var t=this;x.load(V.a,(function(i){t.pigeon=i.scene,t.parent=new d.Group,t.parent.add(t.pigeon),t.parent.frustumCulled=!1,t.parent.castShadow=!0,t.parent.receiveShadow=!0,t.agentPosition=t.parent.position,t.agentRotation=t.parent.rotation,t.agentScale=t.parent.scale,t.agentAnimations=i.animations,t.agentScale.set(.5,.5,.5),t.animationMixer=new d.AnimationMixer(t.parent),t.animationMixer.clipAction(t.agentAnimations[0]).play(),e.add(t.parent)}),void 0,(function(e){console.error(e)}))}},{key:"update",value:function(e,t){this.animationMixer&&(this.animationMixer.update(e),this.updateAgent(t),this.syncPosition(),this.syncRotation())}},{key:"syncPosition",value:function(){this.parent.position.copy(this.position)}},{key:"syncRotation",value:function(){var e,t,i;i=this.velocity,e=Math.atan2(i.x,i.z),t=function(e){return Math.acos(e.y/e.length())}(this.velocity),w(0,1,0,e,this.rotationA),w(0,0,1,t-Math.PI/2,this.rotationB),this.rotationA.multiply(this.rotationB),this.parent.setRotationFromQuaternion(this.rotationA)}}]),i}(P),j=function(){function e(t){Object(o.a)(this,e);var i=new d.SphereGeometry(.2,15,15),n=new d.MeshLambertMaterial({color:new d.Color(1,0,0),wireframe:!1});this.mesh=new d.Mesh(i,n),t.add(this.mesh)}return Object(h.a)(e,[{key:"getVector",value:function(){return this.mesh.position}},{key:"setVector",value:function(e){this.mesh.position.copy(e)}},{key:"setVisibility",value:function(e){this.mesh.visible=e}}]),e}(),C=i(44),F=i.n(C),R=new y.a,T=function(){function e(t){Object(o.a)(this,e),this.loadTerrain(t)}return Object(h.a)(e,[{key:"loadTerrain",value:function(e){var t=this;R.load(F.a,(function(i){t.terrain=i.scene,t.parent=new d.Group,t.parent.add(t.terrain),t.parent.frustumCulled=!1,t.parent.castShadow=!0,t.parent.receiveShadow=!0,t.terrainPosition=t.parent.position,t.terrainRotation=t.parent.rotation,t.terrainScale=t.parent.scale,t.terrainScale.set(50,50,50),e.add(t.parent)}),void 0,(function(e){console.error(e)}))}},{key:"getMesh",value:function(){return this.parent}}]),e}(),E=function(){function e(t){Object(o.a)(this,e),this.theta_rad=0,this.amp=t.amp,this.isClockwise=t.dir,this.originPos=t.pos,this.moveFactor=t.move,this.targetPos=new d.Vector3(0,0,0)}return Object(h.a)(e,[{key:"updateTheta",value:function(e){this.theta_rad=this.isClockwise?this.theta_rad+this.moveFactor:this.theta_rad-this.moveFactor,this.theta_rad=this.theta_rad>=e?0:this.theta_rad}},{key:"cartesianX",value:function(e){return this.originPos.x+e*Math.cos(this.theta_rad)}},{key:"cartesianZ",value:function(e){return this.originPos.z+e*Math.sin(this.theta_rad)}},{key:"cartesianY",value:function(e){return this.originPos.y+this.amp*Math.sin(this.theta_rad)}},{key:"getTargetPos",value:function(){return this.targetPos}},{key:"syncPatternObj",value:function(){}}]),e}(),A=function(e){Object(c.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(o.a)(this,i),(n=t.call(this,e)).radX=e.radx,n.radZ=e.radz,n.maxTheta=2*Math.PI,n}return Object(h.a)(i,[{key:"update",value:function(){var e=this.cartesianX(this.radX),t=this.cartesianZ(this.radZ),i=this.cartesianY();this.targetPos.set(e,i,t),this.updateTheta(this.maxTheta)}}]),i}(E),D=i(6),z=i(73),L=function(){function e(t,i){Object(o.a)(this,e);var n=new D.c(0,0,0),a=new D.c(0,0,0);n.x=t.x-i,n.y=t.y-i,n.z=t.z-i,a.x=t.x+i,a.y=t.y+i,a.z=t.z+i,this.tree=new z.a(n,a,0,2)}return Object(h.a)(e,[{key:"insertPoint",value:function(e,t){this.tree.insert(e,t)}},{key:"scanForPoints",value:function(e,t){return this.tree.findPoints(e,t,!0)}},{key:"pointCount",value:function(){return this.tree.pointCount}}]),e}(),_=function(){function e(){Object(o.a)(this,e),this.flockOctree={}}return Object(h.a)(e,[{key:"update",value:function(e,t){this.setupOctree(e,t)}},{key:"setupOctree",value:function(e,t){var i=this;this.flockOctree=new L(e,20),t.forEach((function(e){i.flockOctree.insertPoint(e.position,e)}))}},{key:"getNeighbours",value:function(e){var t=[];return this.flockOctree.scanForPoints(e,5).forEach((function(e){var i=e.data;t.push(i)})),t}}]),e}(),G=f()(d),X=new d.Raycaster,Z=new d.Vector2,B={container:{zIndex:0,top:"0%",overflowX:"hidden",overflowY:"auto"}},H={showGrid:!0,showTarget:!0},W={height:6,radiusX:10,radiusZ:10,amplitude:0,speed:.3},q=function(e){Object(c.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(o.a)(this,i),(n=t.call(this,e)).state={},n.ref=a.a.createRef(),n.scene=new d.Scene,n.setupCamera(),n.setupProps(),n.setupGui(),n.setupLighting(),n.setupRenderer(),n.setupOrbitControls(),n.target=new j(n.scene),n.stats=new v.a,n.clock=new d.Clock,n.setupPattern(),n.octreeManager=new _,n.pigeons=[],n}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.ref.current.appendChild(this.renderer.domElement),this.ref.current.appendChild(this.stats.dom);for(var e=0;e<50;e++){var t=new M(this.scene);this.pigeons.push(t)}this.initThreeRender(),window.addEventListener("mousemove",this.onMouseMove.bind(this),!1),window.addEventListener("click",this.onClick.bind(this),!0)}},{key:"update",value:function(){var e=this;this.target.setVisibility(H.showTarget);var t=this.clock.getDelta();this.ellipsePattern.update();var i=this.ellipsePattern.getTargetPos();this.octreeManager.update(i,this.pigeons);var n=[];this.pigeons.forEach((function(a){a.setTarget(i),n=e.octreeManager.getNeighbours(a.position),a.update(t,n)})),this.target.setVector(i)}},{key:"render",value:function(){return a.a.createElement("div",{style:B.container,ref:this.ref})}},{key:"initThreeRender",value:function(){this.stats.begin(),this.update(),this.controls.update(),this.renderer.render(this.scene,this.camera),this.stats.end(),requestAnimationFrame(this.initThreeRender.bind(this))}},{key:"setupRenderer",value:function(){this.renderer=new d.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(741907,1),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.outputEncoding=d.sRGBEncoding}},{key:"setupOrbitControls",value:function(){this.controls=new G(this.camera,this.render.domElement),this.controls.enablePan=!0,this.controls.enabled=!0,this.controls.enableKeys=!0}},{key:"setupCamera",value:function(){this.camera=new d.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.05,2e4),this.camera.position.set(4,4,4),this.camera.lookAt(new d.Vector3(0,0,0)),this.camera.frustumCulled=!1}},{key:"setupProps",value:function(){this.terrain=new T(this.scene)}},{key:"setupLighting",value:function(){new d.AmbientLight(14144467).intensity=.5;var e=new d.DirectionalLight(16777215);e.intensity=1,e.position.set(0,100,0).normalize(),this.scene.add(e)}},{key:"setupGui",value:function(){this.gui=new g.a;var e=this.gui.addFolder("World Params");e.add(H,"showGrid").name("Show Grid"),e.add(H,"showTarget").name("Show Target");var t=this.gui.addFolder("Ellipse Params");t.add(W,"height").name("Height").min(5).max(15).step(.5).onFinishChange(this.onFinishEllipseParams.bind(this)),t.add(W,"radiusX").name("RadX").min(5).max(20).step(.5).onFinishChange(this.onFinishEllipseParams.bind(this)),t.add(W,"radiusZ").name("RadZ").min(5).max(20).step(.5).onFinishChange(this.onFinishEllipseParams.bind(this))}},{key:"onFinishEllipseParams",value:function(e){}},{key:"getRandomArbitrary",value:function(e,t){return Math.random()*(t-e)+e}},{key:"setupPattern",value:function(){var e=function(e,t,i,n,a,r){return{pos:e,radx:t,radz:i,amp:n,dir:a,move:r}}(new d.Vector3(0,6,0),10,10,0,!0,d.Math.degToRad(.3));this.ellipsePattern=new A(e)}},{key:"onMouseMove",value:function(e){console.log(Z.x+", "+Z.y)}},{key:"onClick",value:function(e){Z.x=e.clientX/window.innerWidth*2-1,Z.y=-e.clientY/window.innerHeight*2+1,X.setFromCamera(Z,this.camera);for(var t=X.intersectObject(this.terrain.getMesh(),!0),i=0;i<t.length;i++);console.log("Mouse Clicked")}}]),i}(a.a.Component),I=Object(l.a)(q),Y=function(e){Object(c.a)(i,e);var t=Object(u.a)(i);function i(e){var n;return Object(o.a)(this,i),(n=t.call(this,e)).state={},n.totalRef=a.a.createRef(),n.worldRef=a.a.createRef(),n}return Object(h.a)(i,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(I,{ref:this.worldRef}))}},{key:"componentDidUpdate",value:function(){console.log(this.totalRef.current.scrollHeight)}}]),i}(a.a.Component),Q=Object(l.a)(Y),J=i(33);s.a.render(a.a.createElement(J.a,null,a.a.createElement(Q,null)),document.getElementById("root"))}},[[74,1,2]]]);
//# sourceMappingURL=main.1cda48a2.chunk.js.map