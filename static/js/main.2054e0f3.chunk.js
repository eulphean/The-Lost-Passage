(this["webpackJsonpVirtual-Companion"]=this["webpackJsonpVirtual-Companion"]||[]).push([[0],{41:function(t,e,i){t.exports=i.p+"static/media/jellyman.5ff4e054.glb"},72:function(t,e,i){t.exports=i(90)},77:function(t,e,i){},78:function(t,e,i){},90:function(t,e,i){"use strict";i.r(e);var a=i(5),n=i.n(a),s=i(38),r=i.n(s),o=(i(77),i(78),i(0)),h=i(2),c=i(3),l=i(4),u=i(19),d=i(1),f=i(39),p=i.n(f),v=i(40),m=function(t,e,i,a,n){var s=Math.sqrt(t*t+e*e+i*i);t/=s,e/=s,i/=s;var r=Math.cos(a/2),o=Math.sin(a/2);n.set(t*o,e*o,i*o,r)},y=function(){function t(e){Object(o.a)(this,t),this.theta_rad=0,this.amp=e.amp,this.isClockwise=e.dir,this.originPos=e.pos,this.moveFactor=e.move,this.targetPos=new d.Vector3(0,0,0)}return Object(h.a)(t,[{key:"updateTheta",value:function(t){this.theta_rad=this.isClockwise?this.theta_rad+this.moveFactor:this.theta_rad-this.moveFactor,this.theta_rad=this.theta_rad>=t?0:this.theta_rad}},{key:"cartesianX",value:function(t){return this.originPos.x+t*Math.cos(this.theta_rad)}},{key:"cartesianZ",value:function(t){return this.originPos.z+t*Math.sin(this.theta_rad)}},{key:"cartesianY",value:function(t){return this.originPos.y+this.amp*Math.sin(this.theta_rad)}},{key:"getTargetPos",value:function(){return this.targetPos}},{key:"syncPatternObj",value:function(){}}]),t}(),g=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).radX=t.radx,a.radZ=t.radz,a.maxTheta=2*Math.PI,a}return Object(h.a)(i,[{key:"update",value:function(){var t=this.cartesianX(this.radX),e=this.cartesianZ(this.radZ),i=this.cartesianY();this.targetPos.set(t,i,e),this.updateTheta(this.maxTheta)}}]),i}(y),w=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).rad=t.rad,a.phase=t.ph,a.numPetals=t.numP,a.isSin=t.isSin,a.maxTheta=Math.PI,a}return Object(h.a)(i,[{key:"update",value:function(){var t,e,i,a=this.isSin?this.rad*Math.sin(this.phase+this.numPetals*this.theta_rad):this.rad*Math.cos(this.phase+this.numPetals*this.theta_rad);t=this.cartesianX(a),i=this.cartesianZ(a),e=this.cartesianY(),this.targetPos.set(t,e,i),this.updateTheta(this.maxTheta)}}]),i}(y),S=5,k=1.5,b=1.5,P=function(){function t(e,i,a,n){Object(o.a)(this,t),this.idx=i,this.position=new d.Vector3(0,0,0),this.velocity=new d.Vector3(.1,.3,0),this.acceleration=new d.Vector3(0,0,0),this.fSteer=new d.Vector3(0,0,0),this.sumVec=new d.Vector3(0,0,0),this.diffVec=new d.Vector3(0,0,0),this.rotationA=new d.Quaternion,this.rotationB=new d.Quaternion,this.initialPatternPosition=new d.Vector3(0,a,0),this.target=new d.Vector3(0,0,0),this.maxForce=1.5,this.maxSpeed=1.5,this.maxSlowDownSpeed=0,this.slowDownTolerance=.2*.2,this.arriveTolerance=1e-4,this.smoothFactor=.001,this.initPosition(a),this.setupPattern(n)}return Object(h.a)(t,[{key:"initPosition",value:function(t){this.position.x=-50,this.position.z=100,this.position.y=t}},{key:"setupPattern",value:function(t){var e=this.initialPatternPosition.clone(),i=this.idx%2===0,a=function(t,e,i,a,n,s,r,o){return{pos:t,rad:e,ph:i,numP:a,amp:n,isSin:s,dir:r,move:o}}(e,50,t,5,20,i,i,d.Math.degToRad(.1));this.rosePattern=new w(a)}},{key:"updateAgent",value:function(t){this.applyBehaviors(t),this.updatePosition()}},{key:"applyBehaviors",value:function(t){this.seek(),this.applyForce(),this.flock(t)}},{key:"flock",value:function(t){t.length>0&&(this.seperation(t),this.applyForce(),this.cohesion(t),this.applyForce(),this.align(t),this.applyForce())}},{key:"seek",value:function(){this.fSteer.subVectors(this.target,this.position);var t,e,i,a,n,s=this.fSteer.lengthSq();if(this.fSteer.normalize(),s<this.slowDownTolerance&&s>this.arriveTolerance){var r=(t=s,e=this.slowDownTolerance,i=this.arriveTolerance,a=this.maxSpeed,n=this.maxSlowDownSpeed,a+(n-a)*(t-e)/(i-e));this.fSteer.multiplyScalar(r)}else this.fSteer.multiplyScalar(this.maxSpeed);this.fSteer.sub(this.velocity),this.fSteer.clampLength(-99999,this.maxForce)}},{key:"applyForce",value:function(){this.acceleration.add(this.fSteer)}},{key:"updatePosition",value:function(){this.sumVec.addVectors(this.velocity,this.acceleration),this.velocity=this.velocity.lerp(this.sumVec,this.smoothFactor),this.velocity.clampLength(-9999,this.maxSpeed),this.position.add(this.velocity),this.acceleration.multiplyScalar(0)}},{key:"seperation",value:function(t){var e=this;this.fSteer.set(0,0,0),this.sumVec.set(0,0,0),t.length>0&&(t.forEach((function(t){e.diffVec.subVectors(e.position,t.position),e.diffVec.normalize(),e.diffVec.divideScalar(e.diffVec.length()),e.sumVec.add(e.diffVec)})),this.sumVec.divideScalar(t.length),this.sumVec.lengthSq()>0&&(this.sumVec.normalize(),this.sumVec.clampLength(-99999,this.maxSpeed),this.fSteer.subVectors(this.sumVec,this.velocity),this.fSteer.clampLength(-99999,this.maxForce),this.fSteer.multiplyScalar(S)))}},{key:"cohesion",value:function(t){var e=this;this.target.set(0,0,0),this.fSteer.set(0,0,0),t.length>0&&(t.forEach((function(t){e.target.add(t.position)})),this.target.divideScalar(t.length),this.seek(),this.fSteer.multiplyScalar(k))}},{key:"align",value:function(t){var e=this;this.fSteer.set(0,0,0),t.length>0&&(t.forEach((function(t){e.fSteer.add(t.velocity)})),this.fSteer.divideScalar(t.length),this.fSteer.normalize(),this.fSteer.multiplyScalar(this.maxSpeed),this.fSteer.sub(this.velocity),this.fSteer.clampLength(-99999,this.maxForce),this.fSteer.multiplyScalar(b))}}]),t}(),x=i(41),j=i.n(x),O=new v.a,V=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t,a,n,s){var r;return Object(o.a)(this,i),(r=e.call(this,t,a,n,s)).loadLiarbird(t),r}return Object(h.a)(i,[{key:"loadLiarbird",value:function(t){var e=this;O.load(j.a,(function(i){e.jellyman=i.scene,e.jellyman.position.set(0,-1.5,0),e.jellyman.frustumCulled=!1,e.agent=new d.Group,e.agent.add(e.jellyman),e.agent.frustumCulled=!1,e.agent.castShadow=!0,e.agent.receiveShadow=!0,e.agentRotation=e.agent.rotation,e.agentScale=e.agent.scale,e.agentAnimations=i.animations,e.agentScale.set(25,25,25),e.animationMixer=new d.AnimationMixer(e.agent),e.animationMixer.clipAction(e.agentAnimations[0]).play(),t.add(e.agent)}),void 0,(function(t){console.error(t)}))}},{key:"update",value:function(t,e){this.animationMixer&&(this.animationMixer.update(t),this.updateAgent(e),this.syncPosition(),this.syncRotation())}},{key:"syncPosition",value:function(){this.agent.position.copy(this.position)}},{key:"syncRotation",value:function(){var t,e,i;i=this.velocity,t=Math.atan2(i.y,i.x),e=function(t){return Math.acos(t.z/t.length())}(this.velocity),m(0,0,1,t-Math.PI/2,this.rotationA),m(1,0,0,Math.PI/2-e,this.rotationB),this.rotationA.multiply(this.rotationB),this.agent.setRotationFromQuaternion(this.rotationA),this.jellyman.rotation.y+=.05}},{key:"updateRosePattern",value:function(){this.rosePattern.update(),this.setTarget(this.rosePattern.getTargetPos())}},{key:"setTarget",value:function(t){this.target.copy(t)}}]),i}(P),M=i(42),T=i.n(M),R=i(6),F=i(71),z=function(){function t(e,i){Object(o.a)(this,t);var a=new R.c(0,0,0),n=new R.c(0,0,0);a.x=e.x-i,a.y=e.y-i,a.z=e.z-i,n.x=e.x+i,n.y=e.y+i,n.z=e.z+i,this.tree=new F.a(a,n,0,2)}return Object(h.a)(t,[{key:"insertPoint",value:function(t,e){this.tree.insert(t,e)}},{key:"scanForPoints",value:function(t,e){return this.tree.findPoints(t,e,!0)}},{key:"pointCount",value:function(){return this.tree.pointCount}}]),t}(),C=function(){function t(){Object(o.a)(this,t),this.flockOctree={}}return Object(h.a)(t,[{key:"update",value:function(t,e){this.setupOctree(t,e)}},{key:"setupOctree",value:function(t,e){var i=this;this.flockOctree=new z(t,75),e.forEach((function(t){i.flockOctree.insertPoint(t.position,t)}))}},{key:"getNeighbours",value:function(t){var e=[];return this.flockOctree.scanForPoints(t,40).forEach((function(t){var i=t.data;e.push(i)})),e}}]),t}(),E=p()(d),A=0,_=1,W={container:{zIndex:0,top:"0%",overflowX:"hidden",overflowY:"auto"}},D=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).state={},a.ref=n.a.createRef(),a.scene=new d.Scene,a.camera=new d.PerspectiveCamera(100,window.innerWidth/window.innerHeight,.05,2e4),a.camera.position.set(0,150,100),a.camera.lookAt(new d.Vector3(0,0,0)),a.camera.frustumCulled=!1,a.renderer=new d.WebGLRenderer({alpha:!0}),a.liarbirds=[],a.octreeManager=new C,a.curWorldState=A,a.controls=new E(a.camera),a.stats=new T.a,a.clock=new d.Clock,a}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.outputEncoding=d.sRGBEncoding,this.ref.current.appendChild(this.renderer.domElement),this.ref.current.appendChild(this.stats.dom);var t=new d.AmbientLight(14144467);t.intensity=1.5;var e=new d.DirectionalLight(16777215);e.intensity=3,e.position.set(0,50,50).normalize(),this.scene.add(t),this.scene.add(e);for(var i=[0,0,3,3,5,5,7,7,9,9,11,11],a=(Math.abs(-100)+100)/12,n=-100,s=0;s<12;s++){var r=new V(this.scene,s,n,i[s]);this.liarbirds.push(r),n+=a}this.controls.enablePan=!1,this.controls.enabled=!1,this.controls.enableKeys=!1;var o=function(t,e,i,a,n,s){return{pos:t,radx:e,radz:i,amp:a,dir:n,move:s}}(new d.Vector3(0,0,0),60,0,80,!0,d.Math.degToRad(.1));this.flockPattern=new g(o),this.scene.add(new d.AxesHelper(30)),this.initThreeRender(),this.scheduleStates()}},{key:"update",value:function(){var t=this;if(this.curWorldState===_){this.flockPattern.update();var e=this.flockPattern.getTargetPos();this.octreeManager.update(e,this.liarbirds)}var i=this.clock.getDelta(),a=[];this.liarbirds.length>0&&this.liarbirds.forEach((function(e){if(t.curWorldState===_){var n=t.flockPattern.getTargetPos();e.setTarget(n),a=t.octreeManager.getNeighbours(e.position)}else e.updateRosePattern();e.update(i,a)}))}},{key:"render",value:function(){return n.a.createElement("div",{style:W.container,ref:this.ref})}},{key:"initThreeRender",value:function(){this.stats.begin(),this.update(),this.controls.update(),this.renderer.render(this.scene,this.camera),this.stats.end(),requestAnimationFrame(this.initThreeRender.bind(this))}},{key:"updateRendererHeight",value:function(t){var e=window.innerWidth+500;console.log(e);var i=t;this.renderer.setSize(e,i,!0),this.camera.aspect=e/i,this.renderer.setViewport(-500,0,window.innerWidth+500,t+500),this.camera.updateProjectionMatrix()}},{key:"scheduleStates",value:function(){var t=this;setInterval((function(){t.curWorldState===_?t.curWorldState=A:t.curWorldState=_}),2e4)}}]),i}(n.a.Component),L=Object(u.a)(D),B=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).state={},a.totalRef=n.a.createRef(),a.worldRef=n.a.createRef(),a}return Object(h.a)(i,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(L,{ref:this.worldRef}))}},{key:"componentDidMount",value:function(){setTimeout((function(){}),300)}},{key:"componentDidUpdate",value:function(){console.log(this.totalRef.current.scrollHeight)}}]),i}(n.a.Component),I=Object(u.a)(B),X=i(32);r.a.render(n.a.createElement(X.a,null,n.a.createElement(I,null)),document.getElementById("root"))}},[[72,1,2]]]);
//# sourceMappingURL=main.2054e0f3.chunk.js.map