(this["webpackJsonpVirtual-Companion"]=this["webpackJsonpVirtual-Companion"]||[]).push([[0],{109:function(e,t,i){e.exports=i(159)},114:function(e,t,i){},115:function(e,t,i){},159:function(e,t,i){"use strict";i.r(t);var n=i(5),s=i.n(n),a=i(74),o=i.n(a),r=(i(114),i(115),i(0)),c=i(2),h=i(3),l=i(4),u=i(31),d=i(1),p=i(75),f=i.n(p),v=i(33),m=i(50),g=i.n(m),y=function(e,t,i,n,s){var a=Math.sqrt(e*e+t*t+i*i);e/=a,t/=a,i/=a;var o=Math.cos(n/2),r=Math.sin(n/2);s.set(e*r,t*r,i*r,o)},b={MaxForce:.01,SmoothFactor:.01,SeperationForce:1.2,CohesionForce:.5,AlignmentForce:.2},k=function(){function e(){Object(r.a)(this,e),this.position=new d.Vector3(20*Math.random(),2,0),this.velocity=new d.Vector3(.1,.1,.1),this.acceleration=new d.Vector3(0,0,0),this.rotationA=new d.Quaternion,this.rotationB=new d.Quaternion,this.fSteer=new d.Vector3(0,0,0),this.vDesired=new d.Vector3(0,0,0),this.sumVec=new d.Vector3(0,0,0),this.diffVec=new d.Vector3(0,0,0),this.maxSpeed=this.getRandomArbitrary(.015,.05),this.maxSlowDownSpeed=0,this.slowDownTolerance=.2*.2,this.arriveTolerance=1e-4,this.target=new d.Vector3(0,0,0)}return Object(c.a)(e,[{key:"updateAgent",value:function(e){this.seekTarget(),this.flock(e),this.updatePosition()}},{key:"seekTarget",value:function(){this.seek(),this.applyForce()}},{key:"flock",value:function(e){e.length>0&&(this.seperation(e),this.applyForce(),this.cohesion(e),this.applyForce(),this.align(e),this.applyForce())}},{key:"updatePosition",value:function(){this.sumVec.addVectors(this.velocity,this.acceleration),this.velocity=this.velocity.lerp(this.sumVec,b.SmoothFactor),this.velocity.clampLength(-9999,this.maxSpeed),this.position.add(this.velocity),this.acceleration.multiplyScalar(0)}},{key:"applyForce",value:function(){this.acceleration.add(this.fSteer)}},{key:"seek",value:function(){this.vDesired.subVectors(this.target,this.position),this.vDesired.normalize();var e,t,i,n,s,a=this.vDesired.lengthSq();if(a<this.slowDownTolerance&&a>this.arriveTolerance){var o=(e=a,t=this.slowDownTolerance,i=this.arriveTolerance,n=this.maxSpeed,s=this.maxSlowDownSpeed,n+(s-n)*(e-t)/(i-t));this.vDesired.multiplyScalar(o)}else this.vDesired.multiplyScalar(this.maxSpeed);this.fSteer.subVectors(this.vDesired,this.velocity),this.fSteer.clampLength(-99999,b.MaxForce)}},{key:"seperation",value:function(e){var t=this;this.fSteer.set(0,0,0),this.sumVec.set(0,0,0),e.length>0&&(e.forEach((function(e){t.diffVec.subVectors(t.position,e.position),t.diffVec.normalize(),t.diffVec.divideScalar(t.diffVec.length()),t.sumVec.add(t.diffVec)})),this.sumVec.divideScalar(e.length),this.sumVec.lengthSq()>0&&(this.sumVec.normalize(),this.sumVec.clampLength(-99999,this.maxSpeed),this.fSteer.subVectors(this.sumVec,this.velocity),this.fSteer.clampLength(-99999,b.MaxForce),this.fSteer.multiplyScalar(b.SeperationForce)))}},{key:"cohesion",value:function(e){var t=this;this.target.set(0,0,0),this.fSteer.set(0,0,0),e.length>0&&(e.forEach((function(e){t.target.add(e.position)})),this.target.divideScalar(e.length),this.seek(),this.fSteer.multiplyScalar(b.CohesionForce))}},{key:"align",value:function(e){var t=this;this.fSteer.set(0,0,0),e.length>0&&(e.forEach((function(e){t.fSteer.add(e.velocity)})),this.fSteer.divideScalar(e.length),this.fSteer.normalize(),this.fSteer.multiplyScalar(this.maxSpeed),this.fSteer.sub(this.velocity),this.fSteer.clampLength(-99999,b.MaxForce),this.fSteer.multiplyScalar(b.AlignmentForce))}},{key:"setTarget",value:function(e){this.target.copy(e)}},{key:"getRandomArbitrary",value:function(e,t){return Math.random()*(t-e)+e}}]),e}(),P=i(76),w=i.n(P),S=new v.a,O=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).loadPigeon(e),n}return Object(c.a)(i,[{key:"loadPigeon",value:function(e){var t=this;S.load(w.a,(function(i){t.pigeon=i.scene,t.parent=new d.Group,t.parent.add(t.pigeon),t.parent.frustumCulled=!1,t.parent.castShadow=!0,t.parent.receiveShadow=!0,t.agentPosition=t.parent.position,t.agentRotation=t.parent.rotation,t.agentScale=t.parent.scale,t.agentAnimations=i.animations,t.agentScale.set(.5,.5,.5),t.animationMixer=new d.AnimationMixer(t.parent),t.animationMixer.clipAction(t.agentAnimations[0]).play(),e.add(t.parent)}),void 0,(function(e){console.error(e)}))}},{key:"update",value:function(e,t){this.animationMixer&&(this.animationMixer.update(e),this.updateAgent(t),this.syncPosition(),this.syncRotation())}},{key:"syncPosition",value:function(){this.parent.position.copy(this.position)}},{key:"syncRotation",value:function(){var e,t,i;i=this.velocity,e=Math.atan2(i.x,i.z),t=function(e){return Math.acos(e.y/e.length())}(this.velocity),y(0,1,0,e,this.rotationA),y(0,0,1,t-Math.PI/2,this.rotationB),this.rotationA.multiply(this.rotationB),this.parent.setRotationFromQuaternion(this.rotationA)}}]),i}(k),x=function(){function e(t){Object(r.a)(this,e);var i=new d.SphereGeometry(.2,15,15),n=new d.MeshLambertMaterial({color:new d.Color(1,0,0),wireframe:!1});this.mesh=new d.Mesh(i,n),t.add(this.mesh)}return Object(c.a)(e,[{key:"getVector",value:function(){return this.mesh.position}},{key:"setVector",value:function(e){this.mesh.position.copy(e)}},{key:"setVisibility",value:function(e){this.mesh.visible=e}}]),e}(),C=i(77),R=i.n(C),V=new v.a,j=function(){function e(t){Object(r.a)(this,e),this.loadTerrain(t)}return Object(c.a)(e,[{key:"loadTerrain",value:function(e){var t=this;V.load(R.a,(function(i){t.terrain=i.scene,t.parent=new d.Group,t.parent.add(t.terrain),t.parent.frustumCulled=!1,t.parent.castShadow=!0,t.parent.receiveShadow=!0,t.terrainPosition=t.parent.position,t.terrainRotation=t.parent.rotation,t.terrainScale=t.parent.scale,t.terrainScale.set(50,50,50),e.add(t.parent)}),void 0,(function(e){console.error(e)}))}},{key:"getMesh",value:function(){return this.parent}}]),e}(),F={originPosX:0,originPosY:6,originPosZ:0,radiusX:10,radiusZ:10,amplitude:0,speed:.3,isClockwise:!0},M=function(){function e(t){Object(r.a)(this,e),this.theta_rad=0,this.amp=t.amp,this.isClockwise=t.dir,this.originPos=t.pos,this.moveFactor=t.move,this.targetPos=new d.Vector3(0,0,0)}return Object(c.a)(e,[{key:"updateTheta",value:function(e){this.theta_rad=this.isClockwise?this.theta_rad+this.moveFactor:this.theta_rad-this.moveFactor,this.theta_rad=this.theta_rad>=e?0:this.theta_rad}},{key:"cartesianX",value:function(e){return this.originPos.x+e*Math.cos(this.theta_rad)}},{key:"cartesianZ",value:function(e){return this.originPos.z+e*Math.sin(this.theta_rad)}},{key:"cartesianY",value:function(e){return this.originPos.y+this.amp*Math.sin(this.theta_rad)}},{key:"getTargetPos",value:function(){return this.targetPos}},{key:"syncPatternObj",value:function(){}}]),e}(),E=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).radX=e.radx,n.radZ=e.radz,n.maxTheta=2*Math.PI,n}return Object(c.a)(i,[{key:"update",value:function(e){this.setGuiParams(e);var t=this.cartesianX(this.radX),i=this.cartesianZ(this.radZ),n=this.cartesianY();this.targetPos.set(t,n,i),this.updateTheta(this.maxTheta)}},{key:"setGuiParams",value:function(e){this.originPos.set(e.originPosX,e.originPosY,e.originPosZ),this.radX=e.radiusX,this.radZ=e.radiusZ,this.amp=e.amplitude,this.moveFactor=d.Math.degToRad(e.speed),this.isClockwise=e.isClockwise}}]),i}(M),A=i(6),T=i(108),D=function(){function e(t,i){Object(r.a)(this,e);var n=new A.c(0,0,0),s=new A.c(0,0,0);n.x=t.x-i,n.y=t.y-i,n.z=t.z-i,s.x=t.x+i,s.y=t.y+i,s.z=t.z+i,this.tree=new T.a(n,s,0,2)}return Object(c.a)(e,[{key:"insertPoint",value:function(e,t){this.tree.insert(e,t)}},{key:"scanForPoints",value:function(e,t){return this.tree.findPoints(e,t,!0)}},{key:"pointCount",value:function(){return this.tree.pointCount}}]),e}(),I=function(){function e(){Object(r.a)(this,e),this.flockOctree={}}return Object(c.a)(e,[{key:"update",value:function(e,t){this.setupOctree(e,t)}},{key:"setupOctree",value:function(e,t){var i=this;this.flockOctree=new D(e,20),t.forEach((function(e){i.flockOctree.insertPoint(e.position,e)}))}},{key:"getNeighbours",value:function(e){var t=[];return this.flockOctree.scanForPoints(e,5).forEach((function(e){var i=e.data;t.push(i)})),t}}]),e}(),L=g()(d),G={EnableControls:!1,EnablePan:!0,AutoRotate:!1,RotateSpeed:.1,EnableKeys:!0},z=function(){function e(){Object(r.a)(this,e),this.camera=new d.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.05,2e4),this.camera.position.set(4,4,4),this.camera.lookAt(new d.Vector3(0,0,0)),this.camera.frustumCulled=!1,this.controls=new L(this.camera)}return Object(c.a)(e,[{key:"update",value:function(){this.updateControls()}},{key:"updateControls",value:function(){this.controls.update(),this.controls.enablePan=G.EnablePan,this.controls.autoRotate=G.AutoRotate,this.controls.autoRotateSpeed=G.RotateSpeed,this.controls.enabled=G.EnableControls,this.controls.enableKeys=G.EnableKeys}},{key:"getCamera",value:function(){return this.camera}}]),e}(),_=(new d.Raycaster,new d.Vector2,{container:{zIndex:0,top:"0%",overflowX:"hidden",overflowY:"auto"}}),X={ShowGrid:!0,ShowTarget:!0},B=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).state={},n.ref=s.a.createRef(),n.scene=new d.Scene,n.setupProps(),n.setupLighting(),n.setupRenderer(),n.cameraControl=new z,n.target=new x(n.scene),n.stats=new f.a,n.clock=new d.Clock,n.setupPattern(),n.octreeManager=new I,n.pigeons=[],n}return Object(c.a)(i,[{key:"componentDidMount",value:function(){this.ref.current.appendChild(this.renderer.domElement),this.ref.current.appendChild(this.stats.dom);for(var e=0;e<50;e++){var t=new O(this.scene);this.pigeons.push(t)}this.initThreeRender(),window.addEventListener("mousemove",this.onMouseMove.bind(this),!1)}},{key:"update",value:function(){var e=this;this.grid.visible=X.ShowGrid,this.target.setVisibility(X.ShowTarget);var t=this.clock.getDelta();this.ellipsePattern.update(F);var i=this.ellipsePattern.getTargetPos();this.octreeManager.update(i,this.pigeons);var n=[];this.pigeons.forEach((function(s){s.setTarget(i),n=e.octreeManager.getNeighbours(s.position),s.update(t,n)})),this.target.setVector(i)}},{key:"render",value:function(){return s.a.createElement("div",{style:_.container,ref:this.ref})}},{key:"initThreeRender",value:function(){this.stats.begin(),this.update(),this.cameraControl.update(),this.renderer.render(this.scene,this.cameraControl.getCamera()),this.stats.end(),requestAnimationFrame(this.initThreeRender.bind(this))}},{key:"setupRenderer",value:function(){this.renderer=new d.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(741907,1),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.outputEncoding=d.sRGBEncoding}},{key:"setupProps",value:function(){this.terrain=new j(this.scene),this.grid=new d.GridHelper(30,10),this.scene.add(this.grid)}},{key:"setupLighting",value:function(){new d.AmbientLight(14144467).intensity=.5;var e=new d.DirectionalLight(16777215);e.intensity=1,e.position.set(0,100,0).normalize(),this.scene.add(e)}},{key:"getRandomArbitrary",value:function(e,t){return Math.random()*(t-e)+e}},{key:"setupPattern",value:function(){var e=function(e,t,i,n,s,a){return{pos:e,radx:t,radz:i,amp:n,dir:s,move:a}}(new d.Vector3(0,6,0),10,10,0,!0,d.Math.degToRad(.3));this.ellipsePattern=new E(e)}},{key:"onMouseMove",value:function(e){}},{key:"onClick",value:function(e){var t=this.gui.getSaveObject();console.log(t)}}]),i}(s.a.Component),N=Object(u.a)(B),Z=i(106),J=i(43),K=i.n(J),U=i(107),Y=i.n(U),q=new(function(){function e(){Object(r.a)(this,e),this.siteURL="https://befantastic-martha.herokuapp.com/app",this.socket=Y()(this.siteURL,{reconnection:!0,reconnectionDelay:500,reconnectionAttempts:1/0}),this.socket.once("connect",this.subscribe.bind(this)),this.handlePresetsCbk=""}return Object(c.a)(e,[{key:"subscribe",value:function(){console.log("Connected"),this.socket.on("time",this.logTime.bind(this)),this.socket.on("receivePresets",this.handlePresets.bind(this))}},{key:"handlePresets",value:function(e){this.handlePresetsCbk(e)}},{key:"saveGuiPreset",value:function(e,t){var i={name:e,data:t};this.socket.emit("savePreset",i)}},{key:"readAllPresets",value:function(e){this.socket.emit("getPresets"),this.handlePresetsCbk=e}},{key:"deletePreset",value:function(e){this.socket.emit("deletePreset",e)}},{key:"disconnect",value:function(){console.log("Socket Server Disconnected.")}},{key:"logTime",value:function(e){console.log("Socket Connection Alive: "+e)}}]),e}()),H={Preset:"Global",Presets:""},W=function(){function e(){Object(r.a)(this,e),this.gui=new Z.Pane({title:"Pigeon GUI"}),this.gui.addInput(H,"Preset"),this.presetOptions=[],this.buildPresets();var t=this.gui.addFolder({title:"Orbit Controls",expanded:!0});t.addInput(G,"EnableControls",{label:"Enable Controls"}),t.addInput(G,"EnablePan",{label:"Enable Panning"}),t.addInput(G,"AutoRotate",{label:"Enable AutoRotate"}),t.addInput(G,"RotateSpeed",{label:"Rotation Speed",min:.1,max:1}),t.addInput(G,"EnableKeys",{label:"Enable Keys"});var i=this.gui.addFolder({title:"World Params",expanded:!0});i.addInput(X,"ShowGrid",{label:"Show Grid"}),i.addInput(X,"ShowTarget",{label:"Show Target"});var n=this.gui.addFolder({title:"Agent Params",expanded:!0});n.addInput(b,"MaxForce",{label:"Max Force",min:.005,max:2,step:.005}),n.addInput(b,"SmoothFactor",{label:"Smooth Factor",min:.005,max:.1,step:.005}),n.addInput(b,"SeperationForce",{label:"Seperation Force",min:.5,max:2,step:.1}),n.addInput(b,"CohesionForce",{label:"Cohesion Force",min:.1,max:2,step:.1}),n.addInput(b,"AlignmentForce",{label:"Alignment Force",min:0,max:2,step:.1}),this.gui.addButton({title:"Save Preset"}).on("click",this.onSavePreset.bind(this)),this.gui.addButton({title:"Delete Preset"}).on("click",this.onDeletePreset.bind(this)),q.readAllPresets(this.onReceivePresets.bind(this))}return Object(c.a)(e,[{key:"onPresetSelected",value:function(e){var t=JSON.parse(e.value);this.gui.importPreset(t)}},{key:"onReceivePresets",value:function(e){var t=this;if(console.log("All the presets received:"),console.log(e),e.length>0){e.forEach((function(e){var i=e.name,n=e.config;t.presetOptions.push({text:i,value:JSON.stringify(n)})}));var i=e[0].config;this.gui.importPreset(i),this.disposePresets(),this.buildPresets()}}},{key:"onSavePreset",value:function(){var e=H.Preset;if(e.length>0){this.disposePresets();var t=this.gui.exportPreset(),i=K.a.find(this.presetOptions,(function(t){return t.text===e}));i?(console.log("Preset Exists. Updating database and local copy of the preset."),i.value=JSON.stringify(t),this.presetOptions=K.a.sortBy(this.presetOptions,(function(t){return t.text===e?0:1}))):(console.log("Preset doesnt exist. New entry in the database."),this.presetOptions.unshift({text:e,value:JSON.stringify(t)})),q.saveGuiPreset(e,t),this.buildPresets()}else alert("Not an empty entry please.")}},{key:"onDeletePreset",value:function(){if(this.presetOptions.length>0){var e=H.Preset;if(console.log("Deleting preset: "+e),K.a.remove(this.presetOptions,(function(t){return t.text===e})),q.deletePreset(e),this.disposePresets(),this.buildPresets(),this.presetOptions.length>0){var t=this.presetOptions[0].value;this.gui.importPreset(JSON.parse(t))}}}},{key:"disposePresets",value:function(){H.Presets="",this.presetList.dispose()}},{key:"buildPresets",value:function(){this.presetList=this.gui.addInput(H,"Presets",{index:1,options:this.presetOptions}),this.presetList.on("change",this.onPresetSelected.bind(this))}}]),e}(),Q=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).state={},n.totalRef=s.a.createRef(),n.worldRef=s.a.createRef(),n.gui=new W,n}return Object(c.a)(i,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(N,{ref:this.worldRef}))}},{key:"componentDidUpdate",value:function(){console.log(this.totalRef.current.scrollHeight)}}]),i}(s.a.Component),$=Object(u.a)(Q),ee=i(52);o.a.render(s.a.createElement(ee.a,null,s.a.createElement($,null)),document.getElementById("root"))},76:function(e,t,i){e.exports=i.p+"static/media/Bird_simple.d1d4aa0b.glb"},77:function(e,t,i){e.exports=i.p+"static/media/world.9a0ad0bd.glb"}},[[109,1,2]]]);
//# sourceMappingURL=main.9d0db096.chunk.js.map